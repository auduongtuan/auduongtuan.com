import React, {FC, useEffect, useState, useCallback} from "react";
import Link from "next/link";
import { useAppContext } from "../../lib/context/AppContext";
import { useRouter } from "next/router";
import { FiArrowLeft } from "react-icons/fi";
interface NavigationProps {
  fixed?: boolean;
  hideOnScroll?: boolean;
}
interface NavigationAnchorProps {
  props: {
    onClick: void,
    href: string
  }
  ref: any
}
type AnchorProps = React.HTMLProps<HTMLAnchorElement>

const NavigationAnchor = React.forwardRef<HTMLAnchorElement, AnchorProps>(({ onClick, href, className, children }, ref) => {
  return (
    <a href={href} onClick={(e) => {
      onClick && onClick(e);
      e.preventDefault();
      // window.scrollTo(0,0);
    }} ref={ref} className={className}>
      {children}
    </a>
  )
});
NavigationAnchor.displayName = 'NavigationAnchor'
interface CustomLinkProps {
  href: string,
  className?: string
}
const CustomLink: FC<CustomLinkProps> = ({className = '', href, children}) => {
  const router = useRouter();
  const scrollIntoEl = useCallback((hash: string, pathname: string) => {
    if (hash) {
      const el = document.getElementById(hash) as HTMLElement|null;
      if (el) {
        el.scrollIntoView({behavior: 'smooth'});
        history.replaceState(null, '', '#'+hash);
      }
    } else {
      window.scrollTo({top: 0, behavior: 'smooth'});
      history.replaceState(null, '', pathname+(hash ? '#'+hash : ''));
    }
  
    
  }, []);
  const handleOnClick = useCallback((e: React.MouseEvent<HTMLElement>) => {
    e.preventDefault();
    const scrollX = window.pageXOffset;
    const scrollY = window.pageYOffset;

    const location = window.location;
    const urlParts = href.split('#');
    if (location.pathname === urlParts[0]) {
      // console.log(urlParts[1]);
      scrollIntoEl(urlParts[1], urlParts[0]);
    }
    else {
      // neu chung page thi dep me
      router.push(urlParts[0]).then(() => urlParts[1] && scrollIntoEl(urlParts[1], urlParts[0]));
    }
    
  }, []);
  return <a onClick={handleOnClick} href={href} className={className}>{children}</a>

}
const NavigationLink = ({href, children, pathname = '/', className='', activeClassName = 'underline underline-offset-4', inverted = false}:{
  href: string,
  children: React.ReactNode,
  className?: string,
  activeClassName?: string,
  inverted: boolean | undefined | null,
  pathname?: string
}) => {
  const router = useRouter();
  const anchorClassName = `inline-block -mx-2 text-xl px-2 py-1 rounded-xl ${(inverted ? 'text-white hover:bg-white/10' : 'text-blue-900 hover:bg-black/5')} ${router.asPath == href ? ''+activeClassName : ''} ${className}`;
  return (
    // <Link href={href} scroll={false} passHref><NavigationAnchor className={anchorClassName}>{children}</NavigationAnchor></Link>
    <CustomLink href={href} className={anchorClassName}>{children}</CustomLink>
  );
}
export default function Navigation({fixed = true, hideOnScroll = false}: NavigationProps) {
  const appContext = useAppContext();
  const router = useRouter();
  const [scrollUp, setScrollUp] = useState<Boolean>(true);
  const items = [
    {pathname: "/", href: "/#works", name: "Works"},
    {pathname: "/about", href: "/about", name: "About"},
    {pathname: "/", href: "/blog", name: "Blog"},
    // {pathname: "/", href: "/#contact", name: "Contact"},
  ]
  useEffect(() => {
    let lastScrollTop = 0;
    const handleScroll = () => {
      const st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
      const threshold = 10;
      if (Math.abs(st - lastScrollTop) > threshold) {
        if (st > lastScrollTop) {
            // downscroll code
            console.log('Scroll Down');
            setScrollUp(false);
        } else {
            console.log('Scroll Up');
            setScrollUp(true);

            // upscroll code
        }
      }
      lastScrollTop = st;
    };
    if (hideOnScroll) {
      window.addEventListener('scroll', handleScroll);
    }
    return () => {
      if (hideOnScroll) window.removeEventListener('scroll', handleScroll);
    }
  }, [hideOnScroll]);
  return (
    <header className={`${fixed ? 'fixed' : 'absolute'} opacity-0 w-full top-0 z-20 transition-all duration-300 animate-fade-in-fast ${(hideOnScroll && !scrollUp) && '-translate-y-full'} ${(appContext.headerInView ? 'text-white' : 'bg-white-fade text-blue-900')}`}>
      <nav className="text-display text-base md:text-xl font-semibold main-container pt-4 pb-8 md:flex items-center justify-between">
     
        <NavigationLink href="/" className={`flex items-center`} inverted={appContext.headerInView}>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="81"
          height="50"
          fill="none"
          viewBox="0 0 81 50"
          className={`${(appContext.headerInView ? 'fill-white' : 'fill-blue-900')}`}
        >
          <path

            d="M2.738 15.718L2.671 16c0 .054.022.104.067.15a.285.285 0 00.189.067c.072 0 .13-.036.175-.108 1.34-1.784 2.45-3.352 3.332-4.704.881-1.36 1.524-2.36 1.929-3l.984-1.527a31.481 31.481 0 011.929-2.662c-2.428.612-4.33.919-5.705.919-1.376 0-2.365-.086-2.968-.257-.602-.18-.998-.379-1.187-.595-.189-.225-.283-.45-.283-.676 0-.234.009-.46.027-.675.036-.45.306-.82.81-1.109.512-.288.934-.432 1.267-.432.333 0 .5.05.5.149 0 .099-.077.234-.23.405-.144.162-.216.275-.216.338 0 .288 1.039.432 3.116.432s4.464-.274 7.162-.824C15.116.631 16.45 0 17.575 0c.746 0 1.24.212 1.484.635.161.252.242.505.242.757s-.148.505-.445.757c-.288.252-.679.468-1.173.649-.9.324-1.96.58-3.183.77-.513.658-1.241 1.68-2.185 3.068a216.093 216.093 0 01-1.916 2.81c-.341.487-.894 1.352-1.659 2.596-.755 1.243-1.412 2.32-1.969 3.23a49.295 49.295 0 01-1.78 2.676c-1.286 1.82-2.433 2.73-3.44 2.73-.422 0-.787-.113-1.092-.338C.153 20.114 0 19.75 0 19.245c0-.514.279-1.149.836-1.906.567-.765.98-1.256 1.241-1.473.26-.216.436-.324.526-.324.09 0 .135.059.135.176zM23.372 15.772c.171 0 .274.13.31.392.036.26.054.531.054.81 0 .28-.027.474-.08.582-.261.504-.832 1.121-1.714 1.851-.88.72-1.717 1.081-2.508 1.081-.486 0-.936-.148-1.35-.446-.413-.288-.62-.797-.62-1.527 0-.73.194-1.446.58-2.149-2.23 2.802-3.979 4.203-5.247 4.203-.503 0-.912-.18-1.227-.54-.306-.36-.459-.73-.459-1.108 0-.388.054-.784.162-1.19.108-.414.22-.784.338-1.108.125-.324.305-.725.54-1.203.242-.477.422-.824.539-1.04.117-.217.3-.54.553-.973.26-.442.598-1.032 1.011-1.77.423-.74.77-1.285 1.039-1.636.279-.36.548-.54.81-.54.26-.01.49.094.687.31.198.216.297.392.297.527s-.302.743-.904 1.825c-1.78 3.225-2.67 5.104-2.67 5.635 0 .136.049.203.148.203.431 0 1.506-.937 3.223-2.811 1.718-1.874 2.712-3.072 2.981-3.595.27-.531.53-.977.783-1.338.26-.36.454-.581.58-.662.386-.252.885-.388 1.497-.406.099 0 .175.005.229.014.054.009.117.086.189.23.072.144.108.257.108.338-.081.252-.44.923-1.08 2.013-.629 1.09-.98 1.708-1.051 1.852-1.061 2.198-1.592 3.63-1.592 4.297 0 .379.144.568.432.568.521-.072 1.15-.49 1.888-1.257.27-.28.535-.563.796-.851.27-.289.436-.455.499-.5a.34.34 0 01.23-.081z"
          ></path>
          <path

            d="M33.054 9.744c.683 0 1.025.234 1.025.703 0 .252-.058.437-.175.554-.117.117-.369.509-.756 1.176-.377.658-.8 1.504-1.268 2.54-.458 1.028-.755 1.906-.89 2.636a1.38 1.38 0 00-.04.378c0 .496.135.744.404.744.27 0 .59-.127.958-.379a7.57 7.57 0 00.985-.824c.288-.297.566-.6.836-.906.279-.306.445-.482.499-.527.054-.045.135-.067.243-.067.17 0 .274.13.31.392.036.26.054.531.054.81 0 .28-.027.474-.08.582-.262.513-.837 1.13-1.727 1.851-.882.72-1.686 1.081-2.415 1.081-.72 0-1.25-.22-1.591-.662a2.33 2.33 0 01-.513-1.46c0-.54.09-1.013.27-1.418a11.558 11.558 0 01-2.576 2.473c-.962.675-1.75 1.013-2.36 1.013-.612 0-1.111-.184-1.498-.554-.494-.46-.742-1.095-.742-1.905 0-.82.18-1.64.54-2.46a8.845 8.845 0 011.443-2.257 14.186 14.186 0 011.956-1.865c1.492-1.171 2.868-1.757 4.127-1.757.486 0 .881.081 1.187.243.306.162.5.365.58.608.216-.324.396-.527.54-.608.152-.09.377-.135.674-.135zm-1.794 1.5c-1.538 0-3.13.856-4.775 2.568a11.525 11.525 0 00-1.618 2.203c-.486.856-.729 1.441-.729 1.757 0 .315.09.473.27.473.252 0 .953-.496 2.104-1.487 1.151-1 1.915-1.734 2.293-2.203.414-.522 1.232-1.626 2.455-3.31z"
          ></path>
          <path

            d="M40.942 17.934c0 .396.27.595.81.595.287 0 .646-.145 1.078-.433.44-.288.836-.603 1.187-.946.935-.928 1.466-1.392 1.592-1.392.233 0 .35.338.35 1.014 0 .676-.21 1.14-.634 1.392-1.285 1.162-2.279 1.87-2.98 2.122a3.8 3.8 0 01-1.309.189c-.476-.01-.948-.216-1.416-.622-.468-.405-.701-.896-.701-1.473 0-.586.153-1.248.458-1.987.306-.738.616-1.37.93-1.892.325-.531.72-1.144 1.188-1.838.467-.703.715-1.14.742-1.31l-.027-.028c-.297.027-1.034.613-2.212 1.757a68.918 68.918 0 00-2.9 2.987c-.765.847-1.677 1.978-2.738 3.392-.297.388-.54.581-.729.581-.188 0-.44-.058-.755-.175-.324-.127-.521-.217-.593-.27-.072-.055-.108-.136-.108-.244 0-.108.031-.239.094-.392.063-.162.126-.293.189-.392a6.55 6.55 0 01.283-.486c.135-.216.4-.671.796-1.365.405-.703 1.02-1.748 1.848-3.136a178.067 178.067 0 001.483-2.513c.342-.595.62-1.028.837-1.298.404-.513 1.088-.77 2.05-.77.216 0 .324.135.324.405 0 .424-.392 1.221-1.174 2.392l-.566.852c1.555-1.73 2.868-2.825 3.938-3.284.522-.226.99-.338 1.403-.338.422 0 .755.112.998.338.252.225.378.477.378.757 0 .27-.095.599-.284.986-.188.379-.382.72-.58 1.027-.188.298-.44.676-.755 1.136-.315.459-.485.711-.512.756a8.961 8.961 0 00-.216.325c-.108.17-.19.297-.243.378-.054.081-.144.225-.27.433-.126.198-.23.364-.31.5-.072.135-.166.301-.283.5-.108.198-.198.369-.27.513a35.6 35.6 0 00-.202.473c-.126.316-.19.577-.19.784zM61.904 9.933c.278-.621.476-.932.593-.932h.068c.134 0 .409.144.822.432.414.289.62.559.62.811 0 .351-1.15 3.072-3.452 8.163-2.302 5.09-3.624 7.947-3.966 8.568a35.664 35.664 0 01-.688 1.23 5.405 5.405 0 01-.512.69c-.387.477-.868.716-1.443.716-.234 0-.441.027-.62.08-.18.064-.289.096-.325.096-.287 0-.431-.068-.431-.203 0-.027.036-.14.108-.338.08-.19 1.11-2.374 3.089-6.555-2.114-.08-3.97-.144-5.571-.189a53.575 53.575 0 00-4.181 6.082c-.153.297-.297.504-.432.621-.135.127-.32.19-.553.19-.234 0-.486-.122-.755-.365-.27-.235-.405-.51-.405-.825 0-.9 1.16-2.829 3.48-5.784-1.088 0-1.78.027-2.077.081a4.073 4.073 0 01-.553.081c-.243 0-.364-.203-.364-.608 0-.415.238-.775.715-1.081.485-.316 1.133-.473 1.942-.473.063 0 .175-.005.337-.014.557-.027 1.128-.05 1.713-.067a73.132 73.132 0 016.15-6.42c2.14-1.973 3.993-3.356 5.558-4.149.251-.126.45-.185.593-.176.153 0 .333.113.54.338zm-.945 1.906a58.177 58.177 0 00-8.996 8.5c1.591.037 3.201.104 4.829.203 1.636-3.45 3.025-6.352 4.167-8.703zM71.45 24.65c.171 0 .275.132.31.393.037.261.055.531.055.81 0 .28-.027.474-.081.582-.261.504-.832 1.122-1.713 1.851-.882.721-1.718 1.081-2.509 1.081-.486 0-.935-.148-1.349-.445-.413-.289-.62-.798-.62-1.528s.193-1.446.58-2.148c-2.23 2.802-3.98 4.203-5.247 4.203-.504 0-.913-.18-1.227-.541-.306-.36-.46-.73-.46-1.108 0-.388.055-.784.163-1.19.108-.414.22-.783.337-1.108.126-.324.306-.725.54-1.203.242-.477.422-.824.539-1.04.117-.216.301-.54.553-.973.26-.442.598-1.032 1.012-1.77.422-.74.768-1.284 1.038-1.636.279-.36.549-.54.81-.54.26-.01.49.094.687.31.198.217.297.392.297.527 0 .136-.301.744-.904 1.825-1.78 3.225-2.67 5.104-2.67 5.636 0 .135.05.202.148.202.432 0 1.506-.937 3.224-2.81 1.717-1.875 2.71-3.073 2.98-3.596.27-.531.531-.977.783-1.338.26-.36.454-.58.58-.662.387-.252.886-.387 1.497-.405.099 0 .175.004.23.013.053.01.116.086.188.23.072.144.108.257.108.338-.08.252-.44.923-1.079 2.014a73.78 73.78 0 00-1.052 1.851c-1.061 2.198-1.592 3.631-1.592 4.298 0 .378.144.567.432.567.522-.072 1.151-.49 1.888-1.257.27-.279.535-.563.796-.851.27-.288.436-.455.5-.5a.34.34 0 01.229-.081zM20.935 28.457l-.284-.04h-.053c-.225 0-.459-.09-.702-.27-.234-.18-.35-.5-.35-.96 0-.46.247-.982.741-1.568.504-.585 1.183-1.121 2.037-1.608.854-.495 1.915-.9 3.183-1.216a16.769 16.769 0 014.033-.473c2.886 0 5.139.572 6.758 1.716 1.627 1.135 2.44 2.613 2.44 4.433 0 1.135-.25 2.27-.754 3.406a12.362 12.362 0 01-2.024 3.149 18.842 18.842 0 01-2.98 2.69 21.953 21.953 0 01-3.588 2.12c-2.698 1.244-5.279 1.866-7.742 1.866-1.214 0-1.979-.1-2.293-.297a1.384 1.384 0 01-.351-.284 1.527 1.527 0 00-.256-.27c-.171-.109-.257-.338-.257-.69 0-.36.036-.684.108-.973.27-.964 1.48-3.054 3.629-6.27 2.158-3.226 3.96-5.825 5.408-7.799.1-.135.607-.234 1.524-.297.378 0 .639.027.783.081.144.054.216.153.216.298 0 .135-.234.531-.702 1.189-.467.648-1.97 2.933-4.505 6.852-2.536 3.91-3.803 5.92-3.803 6.027 0 .108.395.163 1.186.163.8 0 1.78-.167 2.94-.5a17.13 17.13 0 003.292-1.339 21.288 21.288 0 002.94-1.905 17.61 17.61 0 002.401-2.23c1.457-1.658 2.185-3.13 2.185-4.42 0-1.288-.589-2.382-1.767-3.283-1.169-.901-2.774-1.352-4.815-1.352-1.376 0-2.675.23-3.898.69-1.223.459-2.064.869-2.522 1.23-.459.36-.688.603-.688.729 0 .072.054.108.162.108l.58-.108c.08 0 .121.018.121.054 0 .036-.076.1-.23.19-.152.09-.278.189-.377.297-.09.099-.324.265-.701.5-.378.225-.72.346-1.025.364zM48.286 37.458c.17 0 .274.131.31.392.036.261.054.532.054.811 0 .28-.027.473-.08.581-.262.505-.833 1.122-1.714 1.852-.881.72-1.717 1.081-2.509 1.081-.485 0-.935-.149-1.348-.446-.414-.288-.62-.797-.62-1.527 0-.73.192-1.446.58-2.149-2.23 2.802-3.98 4.203-5.248 4.203-.503 0-.912-.18-1.227-.54-.306-.36-.459-.73-.459-1.109 0-.387.054-.784.162-1.189.108-.414.22-.784.337-1.108.126-.325.306-.726.54-1.203.243-.478.422-.825.54-1.04.116-.217.3-.541.552-.974.261-.441.598-1.031 1.012-1.77.423-.739.769-1.284 1.038-1.636.28-.36.549-.54.81-.54.26-.01.49.095.688.31.197.217.296.393.296.528s-.3.743-.903 1.824c-1.78 3.226-2.67 5.104-2.67 5.636 0 .135.049.203.148.203.431 0 1.506-.937 3.223-2.811 1.718-1.874 2.711-3.073 2.981-3.595.27-.532.53-.978.782-1.338.261-.36.454-.581.58-.662.387-.253.886-.388 1.497-.406.1 0 .176.005.23.014.054.009.117.085.189.23.072.144.107.256.107.337-.08.252-.44.924-1.079 2.014-.629 1.09-.98 1.707-1.052 1.852-1.06 2.198-1.591 3.63-1.591 4.297 0 .379.144.568.431.568.522-.072 1.151-.491 1.889-1.257.27-.28.535-.563.795-.852.27-.288.437-.455.5-.5a.34.34 0 01.229-.08z"
          ></path>
          <path

            d="M56.835 31.404c.27 0 .544.121.822.365.288.243.432.617.432 1.121 0 .496-.175 1.145-.526 1.947-.35.792-.832 1.603-1.443 2.432a20.58 20.58 0 01-2.023 2.325c-.729.72-1.52 1.315-2.374 1.784-.846.46-1.614.689-2.307.689-.692 0-1.25-.216-1.672-.649-.414-.441-.62-1.05-.62-1.824 0-.784.188-1.65.566-2.595a9.428 9.428 0 011.483-2.5 14.367 14.367 0 011.956-1.96c1.466-1.18 2.752-1.77 3.858-1.77.494 0 .867.121 1.12.364.09.082.134.154.134.217v.08c.126-.017.324-.026.594-.026zM55.472 33.2h-.094c-.315 0-.472-.23-.472-.69-.657.217-1.344.596-2.064 1.136a9.983 9.983 0 00-1.929 1.92c-1.15 1.477-1.735 2.725-1.753 3.743 0 .504.184.757.553.757.369 0 .917-.244 1.645-.73.729-.487 1.448-1.18 2.159-2.081.719-.901 1.254-1.68 1.605-2.338.36-.667.54-1.118.54-1.352 0-.243-.064-.365-.19-.365zM64.723 39.62c0 .397.27.595.809.595.288 0 .647-.144 1.079-.432.44-.288.836-.604 1.187-.946.935-.928 1.465-1.392 1.591-1.392.234 0 .351.338.351 1.013 0 .676-.211 1.14-.634 1.392-1.286 1.163-2.28 1.87-2.98 2.122a3.8 3.8 0 01-1.309.19c-.477-.01-.949-.217-1.416-.622-.468-.406-.702-.897-.702-1.473 0-.586.153-1.248.459-1.987.306-.739.616-1.37.93-1.892.324-.532.72-1.144 1.188-1.838.467-.703.714-1.14.741-1.311l-.027-.027c-.296.027-1.034.613-2.212 1.757a68.787 68.787 0 00-2.9 2.987c-.764.847-1.676 1.977-2.738 3.392-.296.387-.54.581-.728.581-.189 0-.44-.059-.755-.176-.324-.126-.522-.216-.594-.27-.072-.054-.108-.135-.108-.243 0-.108.032-.239.095-.392.063-.162.126-.293.189-.392.054-.108.148-.27.283-.487.135-.216.4-.67.796-1.365a262.13 262.13 0 011.848-3.135 176.993 176.993 0 001.483-2.514c.342-.594.62-1.027.836-1.297.405-.514 1.089-.77 2.05-.77.216 0 .324.135.324.405 0 .423-.39 1.22-1.173 2.392l-.567.851c1.556-1.73 2.869-2.824 3.939-3.284.521-.225.989-.337 1.403-.337.422 0 .755.112.998.337.251.226.377.478.377.757 0 .27-.094.6-.283.987-.189.378-.382.72-.58 1.027-.189.297-.44.676-.755 1.135-.315.46-.486.712-.513.757a9.11 9.11 0 00-.215.324c-.108.172-.19.298-.243.379-.054.08-.144.225-.27.432-.126.198-.23.365-.31.5-.072.135-.167.302-.284.5-.107.198-.197.37-.27.514l-.202.473c-.126.315-.188.576-.188.784z"
          ></path>
          <path

            d="M72.556 32.728c.873-.604 1.727-1.068 2.563-1.392.837-.324 1.56-.486 2.172-.486.611 0 1.002.175 1.173.527a1.79 1.79 0 011.309-.649c.153-.009.341-.014.566-.014.225 0 .364.032.418.095.054.054.104.162.149.324.044.163.072.253.08.27.01.019.014.05.014.095 0 .036-.022.086-.067.149a1.382 1.382 0 01-.162.162l-.095.095c-1.987 2.856-4.02 6.113-6.096 9.77 2.14-1.9 4.055-3.265 5.746-4.094a.692.692 0 01.31-.081c.144 0 .238.094.283.284.045.18.068.441.068.783 0 .343-.023.555-.068.636-.036.08-.243.243-.62.486l-1.47.946c-.603.388-1.241.816-1.916 1.284-1.618 1.126-2.95 2.311-3.992 3.555-1.35 1.63-2.316 2.946-2.9 3.946-.216.387-.58.581-1.093.581-1.016 0-1.524-.482-1.524-1.446 0-.982.481-1.987 1.443-3.014.72-.766 1.38-1.392 1.983-1.878.603-.487.93-.762.985-.825.665-1 1.569-2.419 2.71-4.257-.97 1.018-1.915 1.829-2.832 2.433-.908.603-1.587.905-2.036.905-1.376 0-2.064-.59-2.064-1.77 0-.937.238-1.883.715-2.838a9.757 9.757 0 011.834-2.555 16.652 16.652 0 012.415-2.027zm5.14-.351c-1.044.225-2.024.599-2.94 1.121-.918.514-1.674 1.068-2.267 1.663a12.844 12.844 0 00-1.538 1.81c-.809 1.163-1.213 2.064-1.213 2.704 0 .153.035.23.107.23.081 0 .252-.082.513-.244.27-.162.647-.437 1.133-.824a40.093 40.093 0 001.618-1.406c1.376-1.27 2.905-2.955 4.586-5.054z"
          ></path>
        </svg>
        </NavigationLink>
  
        <ul className="md:flex gap-20 items-center hidden">
         {items.map((item, i) => <li key={i}><NavigationLink pathname={item.pathname} href={item.href} inverted={appContext.headerInView}>{item.name}</NavigationLink></li>)}
        </ul>
      </nav>
    </header>
  );
}
